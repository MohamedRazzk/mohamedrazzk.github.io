<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  
    

    
  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="InsomniHackTeaser Crypto 18 - Rule86" />
<meta name="author" content="Mohamed F. Razzk" />
<meta property="og:locale" content="en" />
<meta name="description" content="Inroduction" />
<meta property="og:description" content="Inroduction" />
<link rel="canonical" href="http://localhost:4000/posts/InsomniHack-Teaser-18/" />
<meta property="og:url" content="http://localhost:4000/posts/InsomniHack-Teaser-18/" />
<meta property="og:site_name" content="Razzk" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-13T08:10:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="InsomniHackTeaser Crypto 18 - Rule86" />
<meta name="twitter:site" content="@mohamedrazzk" />
<meta name="twitter:creator" content="@mohamedrazzk" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mohamed F. Razzk","url":"https://twitter.com/mohamedrazzk"},"dateModified":"2020-07-13T08:10:00+02:00","datePublished":"2020-07-13T08:10:00+02:00","description":"Inroduction","headline":"InsomniHackTeaser Crypto 18 - Rule86","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/InsomniHack-Teaser-18/"},"url":"http://localhost:4000/posts/InsomniHack-Teaser-18/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>InsomniHackTeaser Crypto 18 - Rule86 | Razzk
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Razzk">
<meta name="application-name" content="Razzk">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fastly.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://fastly.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://fastly.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
</head>


  <body data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Razzk</a>
    </div>
    <div class="site-subtitle font-italic">Cyber Security Engineer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/mohamedrazzk" aria-label="github"
        

        
          target="_blank"
          
        

        

        rel="noopener noreferrer">

        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/mohamedrazzk" aria-label="twitter"
        

        
          target="_blank"
          
        

        

        rel="noopener noreferrer">

        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="javascript:location.href = 'mailto:' + ['contact','razzk.net'].join('@')" aria-label="email"
        

        

        

        >

        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        

        

        

        >

        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>InsomniHackTeaser Crypto 18 - Rule86</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- return -->

<h1 data-toc-skip>InsomniHackTeaser Crypto 18 - Rule86</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1594620600"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Jul 13, 2020
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        
          <a href="https://twitter.com/mohamedrazzk">Mohamed F. Razzk</a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1625 words">
  <em>9 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h2 id="inroduction"><span class="mr-2">Inroduction</span><a href="#inroduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<blockquote>
  <p>InsomniHack Teaser CTF 2018 - Rule86</p>
</blockquote>

<h2 id="description"><span class="mr-2">Description</span><a href="#description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Kevin is working on a new synchronous stream cipher, but he has been re-using his key.</p>

<p>In this challenge, you are provided with 4 files:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>hint.gif.enc          - An encrypted GIF
super_cipher.py.enc   - An encrypted python script
rule86.txt            - A cleartext file 
rule86.txt.enc        - The encrypted version of said file
</pre></td></tr></tbody></table></code></div></div>

<h2 id="writeup"><span class="mr-2">Writeup</span><a href="#writeup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Step 1
we started by getting the keystream from the <code class="language-plaintext highlighter-rouge">rule86.txt</code> file and its encrypted counterpart</p>
<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">p1</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'rule86.txt'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">c1</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'rule86.txt.enc'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>

<span class="n">keystream</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
    <span class="n">keystream</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>And then, decrypting the other encrypted files</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">c2</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'super_cipher.py.enc'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">p2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">keystream</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
    <span class="n">p2</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">bytes</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Since the <code class="language-plaintext highlighter-rouge">rule86.txt.enc</code> file is smaller then <code class="language-plaintext highlighter-rouge">super_cipher.py.enc</code> and <code class="language-plaintext highlighter-rouge">hint.gif.enc</code> we don’t have enough keystream to decrypt the latters.</p>

<p>Step 2</p>

<p>We noticed that the decrypted script was generating a 32-byte integer with a PRNG from the <code class="language-plaintext highlighter-rouge">key</code> (aka the flag) and using that as keystream.</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">RULE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">86</span> <span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
<span class="n">N_BYTES</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">N_BYTES</span>

<span class="n">def</span> <span class="n">next</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">:</span>
  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">:</span>
    <span class="n">y</span> <span class="o">|=</span> <span class="n">RULE</span><span class="p">[(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">i</span>
  <span class="k">return</span> <span class="n">y</span>

<span class="cp"># Bootstrap the PNRG
</span><span class="n">keystream</span> <span class="o">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">key</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span><span class="err">'</span><span class="n">little</span><span class="err">'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">N</span><span class="c1">//2):</span>
  <span class="n">keystream</span> <span class="o">=</span> <span class="n">next</span><span class="p">(</span><span class="n">keystream</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>The simple way to solve this and decrypt the gif and the script was to retrive the starting 32-byte integer from the known keystream and then using the PRNG function to reproduce the keystream by generating all the integer we wanted.</p>

<p><a href="/assets/img/sample/gif.png" class="popup img-link "><img data-src="/assets/img/sample/gif.png" alt="upload-image" class="lazyload" data-proofer-ignore></a></p>

<p>So I’ve made a recreate script part of the gif following this pattern.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="n">l1</span><span class="o">=</span><span class="p">[</span><span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x2b</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x55</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x80</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\xaa</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\xd5</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\xff</span><span class="s">'</span><span class="p">]</span>
<span class="n">l2</span><span class="o">=</span><span class="p">[</span><span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x33</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x66</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x99</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\xcc</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\xff</span><span class="s">'</span><span class="p">]</span>

<span class="n">header</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x47\x49\x46\x38\x39\x61\x67\x02\xE6\x00\xF7\x00\x00</span><span class="s">'</span>

<span class="n">ary</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span> <span class="o">+</span> <span class="n">header</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">l1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">l2</span><span class="p">:</span>
            <span class="n">ary</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span>

<span class="n">gne</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'hint_full.gif'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
<span class="n">gne</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">ary</span><span class="p">)</span>
<span class="n">gne</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="c1"># l1 l2 l1 l1 l2 l1 l1 l2 l1 l1 l2 l1 l1 l2 l1 l1 l2 l1
# 00 00 00 00 00 33 00 00 66 00 00 99 00 00 CC 00 00 FF
# 00 2B 00 00 2B 33 00 2B 66 00 2B 99 00 2B CC 00 2B FF
# 00 55 00 00 55 33 00 55 66 00 55 99 00 55 CC 00 55 FF
</span></pre></td></tr></tbody></table></code></div></div>

<p>All went smooth and without problem so I kept thinking it was the good approach, beside that the gif was corrupted, but the keystream was right and we decrypted all the script</p>

<p><a href="/assets/img/sample/hint.gif" class="popup img-link "><img data-src="/assets/img/sample/hint.gif" alt="upload-image" class="lazyload" data-proofer-ignore></a></p>

<p>Script for recovering the super_cipher.py file</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="n">p1</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'rule86.txt'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">c1</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'rule86.txt.enc'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">c2</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'super_cipher.py.enc'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">c3</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'hint.gif.enc'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>

<span class="c1"># get the first part of the keystream
</span><span class="n">keystream</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
  <span class="n">keystream</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># decrypt the gif file
</span><span class="n">p3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">keystream</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span>
  <span class="n">p3</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>
    
<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="s">'hint2.gif'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="nf">bytes</span><span class="p">(</span><span class="n">p3</span><span class="p">))</span>

<span class="c1"># run giffer.py to generate hint_full.gif
</span>
<span class="c1"># get another keystream part
</span><span class="n">keystream</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gif</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'hint_full.gif'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">gif</span><span class="p">):</span>
  <span class="n">keystream</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># decrypt the full python script
</span><span class="n">p2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">keystream</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
  <span class="n">p2</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">bytes</span><span class="p">(</span><span class="n">p2</span><span class="p">).</span><span class="nf">decode</span><span class="p">())</span>
    
<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="s">'super_cipher1.py'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="nf">bytes</span><span class="p">(</span><span class="n">p2</span><span class="p">).</span><span class="nf">decode</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Step 3
Now we know that the flag is the seed of the PRNG used as encryption keystream.
We only need to reverse it and get the previous number for each step. Easy.</p>

<p>Let’s start from this line.
<code class="language-plaintext highlighter-rouge">x = (x &amp; 1) &lt;&lt; N+1 | x &lt;&lt; 1 | x &gt;&gt; N-1</code></p>

<p><code class="language-plaintext highlighter-rouge">(x &amp; 1)</code> get the lsb from <code class="language-plaintext highlighter-rouge">x</code> (our starting number)
<code class="language-plaintext highlighter-rouge">(x &amp; 1) &lt;&lt; N+1</code> will shift it 257 positions left (N = 256)</p>

<p>if <code class="language-plaintext highlighter-rouge">x</code> lsb is 0, <code class="language-plaintext highlighter-rouge">(x &amp; 1) &lt;&lt; N+1</code> will be <code class="language-plaintext highlighter-rouge">0</code>
if <code class="language-plaintext highlighter-rouge">x</code> lsb is 1. <code class="language-plaintext highlighter-rouge">(x &amp; 1) &lt;&lt; N+1</code> will be <code class="language-plaintext highlighter-rouge">1 &lt;&lt; 257</code></p>

<p><code class="language-plaintext highlighter-rouge">x &lt;&lt; 1</code> shift <code class="language-plaintext highlighter-rouge">x</code> by 1 position to the left</p>

<p><code class="language-plaintext highlighter-rouge">x &gt;&gt; N-1</code> will take the 2 msb, shift them by 255 positions right and OR them as lsb</p>

<p>Turns out this is very easy to reverse and also the output number has its 2 msb equals to its 2 lsb.</p>

<p>The reverse operation is the following: <code class="language-plaintext highlighter-rouge">x = (x &gt;&gt; 1) &amp; ((1 &lt;&lt; N)-1)</code></p>

<p><code class="language-plaintext highlighter-rouge">x &gt;&gt; 1</code> shift <code class="language-plaintext highlighter-rouge">x</code> by 1 position right, eliminating the 2 lsb added above.</p>

<p>The AND operation filters the first operand’s bits where the second operand has bits set to 1. 
<code class="language-plaintext highlighter-rouge">(1 &lt;&lt; N)</code> is <code class="language-plaintext highlighter-rouge">0b1000000</code> with N zeros. Minus one will result in <code class="language-plaintext highlighter-rouge">0b111111</code> with N ones.</p>

<p>We are effectively filtering only the N bits we wanted, eliminating the 2 msb added above.</p>

<p>Then the PRNG takes 3 bits at a time from the right and substitute them by the RULE array.</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">:</span>
    <span class="n">y</span> <span class="o">|=</span> <span class="n">RULE</span><span class="p">[(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">i</span>
</pre></td></tr></tbody></table></code></div></div>
<p>For example if we have <code class="language-plaintext highlighter-rouge">0b1100</code>, the for works like this:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">RULE</span><span class="p">[</span><span class="mb">0b100</span><span class="p">]</span> <span class="c1"># 0bXXX100
</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RULE</span><span class="p">[</span><span class="mb">0b110</span><span class="p">]</span> <span class="c1"># 0bXX110X 
</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">RULE</span><span class="p">[</span><span class="mb">0b11</span><span class="p">]</span>  <span class="c1"># 0bX011XX
</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RULE</span><span class="p">[</span><span class="mb">0b1</span><span class="p">]</span>   <span class="c1"># 0b001XXX
</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        <span class="c1"># reverse y 
</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Output y will be <code class="language-plaintext highlighter-rouge">0b1011</code></p>

<p>Reversing this is pretty easy too, just scan y and get the possible preimage values of RULE mapping function that result in either 1 or 0.
If the current y bit is 1, check what value in RULE output 1 and check if that value is consistent with the previous ones (since chosen bits form x are overlapping)</p>

<p>To recovery  the integer keystream</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>

<span class="n">RULE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">86</span> <span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
<span class="n">N_BYTES</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">N_BYTES</span>

<span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">|=</span> <span class="n">RULE</span><span class="p">[(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">i</span>
  <span class="k">return</span> <span class="n">y</span>

<span class="n">p</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'rule86.txt'</span><span class="p">,</span><span class="s">'rb'</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'rule86.txt.enc'</span><span class="p">,</span><span class="s">'rb'</span><span class="p">)</span>

<span class="n">plaintext</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">N_BYTES</span><span class="p">)</span>
<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">N_BYTES</span><span class="p">)</span>

<span class="c1"># print the full keystream
</span><span class="k">while</span> <span class="n">plaintext</span><span class="p">:</span>
  <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="nf">from_bytes</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span><span class="s">'little'</span><span class="p">)</span> <span class="o">^</span> <span class="nb">int</span><span class="p">.</span><span class="nf">from_bytes</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span><span class="s">'little'</span><span class="p">)</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">plaintext</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">N_BYTES</span><span class="p">)</span>
  <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">N_BYTES</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>For reverseing the PRNG and get the seed/flag</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="rouge-code"><pre><span class="n">RULE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">86</span> <span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
<span class="n">N_BYTES</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">N_BYTES</span>

<span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">N</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">|=</span> <span class="n">RULE</span><span class="p">[(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">i</span>
  <span class="k">return</span> <span class="n">y</span>


<span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
  <span class="n">valid</span> <span class="o">=</span> <span class="p">[]</span>                            <span class="c1"># declare a valid array since the preimage of a value according
</span>                                        <span class="c1"># to the rule can be the result of 4 different input
</span>  
  <span class="n">ycell</span> <span class="o">=</span> <span class="n">y</span> <span class="o">&amp;</span> <span class="mb">0b1</span>                       <span class="c1"># get the last bit
</span>  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">RULE</span><span class="p">)):</span>            <span class="c1"># for every rule 
</span>    <span class="k">if</span> <span class="n">RULE</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">ycell</span><span class="p">:</span>                <span class="c1"># check if the result match our expected value
</span>      <span class="n">valid</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>                   <span class="c1"># add the value as valid
</span>  
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>                 <span class="c1"># for every bit in y (should be 256/258 bit)
</span>    <span class="n">newvalid</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>                     <span class="c1"># for every previous valid value
</span>      <span class="n">ycell</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mb">0b1</span>            <span class="c1"># get the y target cell (1 bit)
</span>      <span class="n">xcell</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mb">0b011</span>          <span class="c1"># get the x target cell (2 bit out of 3) from the previous valid
</span>      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">RULE</span><span class="p">)):</span>        
        <span class="k">if</span> <span class="n">RULE</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">ycell</span><span class="p">:</span>
          <span class="nf">if </span><span class="p">(</span><span class="n">j</span> <span class="o">&amp;</span> <span class="mb">0b011</span><span class="p">)</span> <span class="o">==</span> <span class="n">xcell</span><span class="p">:</span>      <span class="c1"># check if the result match our target one
</span>            <span class="n">v</span> <span class="o">|=</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>               <span class="c1"># "add" our match to the already valid one
</span>            <span class="n">newvalid</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>          <span class="c1"># update the valid list
</span>    <span class="n">valid</span> <span class="o">=</span> <span class="n">newvalid</span>

  <span class="n">x</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>                       <span class="c1"># for every valid 256 bit value
</span>    <span class="nf">if </span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="mi">256</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="mb">0b11</span><span class="p">):</span>        <span class="c1"># check if the 2 msb are equals to the 2 lsb
</span>      <span class="n">x</span> <span class="o">=</span> <span class="n">v</span>                             <span class="c1"># we found our previous x 
</span>
  <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Error no valid integer!"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
          
  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>           <span class="c1"># fix our x accordingly
</span>  <span class="k">return</span> <span class="n">x</span>


<span class="c1">#values from the keystream
</span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">37450399269036614778703305999225837723915454186067915626747458322635448226786</span><span class="p">,</span>
<span class="mi">100622653914913501834016856771730649612864879431221716975620828032766397709367</span><span class="p">,</span>
<span class="mi">30565965598786057661696410930164890805958057693583615925316094177133280560720</span><span class="p">,</span>
<span class="mi">103573567656710023306192266386049368645675636074643938780342918703636500548568</span><span class="p">,</span>
<span class="mi">28509515191943075455625810763252620824333983857860790449437105502768741406797</span><span class="p">,</span>
<span class="mi">87537284303558144156631836069957764733725337398790274426598731583572530580725</span><span class="p">,</span>
<span class="mi">44716782229954850790645591045965014941901610454109696374926338641251779999508</span><span class="p">,</span>
<span class="mi">82447195088123999846117257332504341489187184956851468679950679621555020370358</span><span class="p">,</span>
<span class="mi">66901809945344917781374326984783824023739095925450107364519045210557505092242</span><span class="p">,</span>
<span class="mi">114067135427233025222698564170101622975443616062287263643297019211756836637438</span><span class="p">,</span>
<span class="mi">2884516673931260333907001189797696957250433333677043264446344069828816140802</span><span class="p">,</span>
<span class="mi">5289872070696193140037770894656341630909797897334877860267293814493245082375</span><span class="p">,</span>
<span class="mi">69023781971677661808035522723190242410127104903614192265146189107040377117065</span><span class="p">,</span>
<span class="mi">107613775284599791185420266567845597101440592435618453390961765397563059875550</span><span class="p">,</span>
<span class="mi">16357066489843479901612193664610011889060446509506296924636891723597443981890</span><span class="p">,</span>
<span class="mi">57186523063755103597333412726627151956381596060761612487300750841069890516967</span><span class="p">]</span>


<span class="c1"># try to reverse the keystream
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
  <span class="nf">next</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">a</span> <span class="o">=</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

  <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">'Error in keystream'</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">()</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">'OK ---'</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
  
<span class="nf">print</span><span class="p">(</span><span class="s">"YOU ROCK! Keystream reversed.</span><span class="se">\n</span><span class="s">Reversing 128 bootstrap rounds..."</span><span class="p">)</span>

<span class="c1"># after this you should go 128 block reverse and get the PRNG seed aka FLAG
</span><span class="n">curr</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">129</span><span class="p">):</span>
  <span class="n">curr</span> <span class="o">=</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">curr</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"128 rounds done.</span><span class="se">\n</span><span class="s">Printing flag...</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="nf">to_bytes</span><span class="p">(</span><span class="n">N_BYTES</span><span class="p">,</span><span class="s">'little'</span><span class="p">).</span><span class="nf">decode</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></div></div>
<p>` Flag is Captured ` » <code class="language-plaintext highlighter-rouge">INS{Rule86_is_W0lfr4m_Cha0s}</code></p>


</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/cryptography-engineering/'>Cryptography Engineering</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/cryptography/"
          class="post-tag no-text-decoration" >Cryptography</a>
      
      <a href="/tags/pyhton/"
          class="post-tag no-text-decoration" >Pyhton</a>
      
      <a href="/tags/insomnihackteaser-cryptography-engineering/"
          class="post-tag no-text-decoration" >InsomniHackTeaser-Cryptography Engineering</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/cryptography/">Cryptography</a>
    
      
      <a class="post-tag" href="/tags/pyhton/">Pyhton</a>
    
      
      <a class="post-tag" href="/tags/c/">C++</a>
    
      
      <a class="post-tag" href="/tags/qiwi-cryptography-engineering/">Qiwi-Cryptography Engineering</a>
    
      
      <a class="post-tag" href="/tags/ct-reverse-engineering/">CT-Reverse Engineering</a>
    
      
      <a class="post-tag" href="/tags/cybersecuriy/">cybersecuriy</a>
    
      
      <a class="post-tag" href="/tags/math/">Math</a>
    
      
      <a class="post-tag" href="/tags/port-scanner/">port Scanner</a>
    
      
      <a class="post-tag" href="/tags/python/">python</a>
    
      
      <a class="post-tag" href="/tags/tamu-cryptography-engineering/">TAMU-Cryptography Engineering</a>
    

    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
    <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
    <nav id="toc"></nav>
  </div>

  <!-- toc.js will be loaded at medium priority -->
  <script src="https://fastly.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/Crypto-100_1/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1531807800"
    data-df="ll"
    >
  Jul 17, 2018
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>QIWI - Crypto 100_1</h3>
            <div class="text-muted small">
              <p>
                





                Inroduction


  Qiwi-Infosec - Crypto 100_1 cipher text need to be decoded to read the secret message .


Description

We got a cipher text that was five lines long and consisted of underscores and...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Crypto-300_1/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1534054200"
    data-df="ll"
    >
  Aug 12, 2018
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>QIWI - Crypto 300_1</h3>
            <div class="text-muted small">
              <p>
                





                Inroduction


  Qiwi-Infosec - Crypto 300_1 shared key in decimal.


Description

Alice, Bob, and Cameron want to get shared key by Diffie-Hellman method. Their public keys respectively are g^a mod...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Crypto-400_1/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1536127800"
    data-df="ll"
    >
  Sep  5, 2018
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>QIWI - Crypto 400_1</h3>
            <div class="text-muted small">
              <p>
                





                Inroduction


  Qiwi-Infosec - Crypto 400_1 based on Coppersmith’s attack.


Description

Message m has been encrypted by RSA with exponent e=3 for three users. Users have been used different modul...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/RITSEC-18-CictroHash/" class="btn btn-outline-primary"
    prompt="Older">
    <p>RITSEC Crypto 18 - CictroHash</p>
  </a>
  

  
  <a href="/posts/Python-In-Cybersecurity-Port-Scanner/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Python in Cybersecurity - Port Scanner</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/cryptography/">Cryptography</a>
    
      
      <a class="post-tag" href="/tags/pyhton/">Pyhton</a>
    
      
      <a class="post-tag" href="/tags/c/">C++</a>
    
      
      <a class="post-tag" href="/tags/qiwi-cryptography-engineering/">Qiwi-Cryptography Engineering</a>
    
      
      <a class="post-tag" href="/tags/ct-reverse-engineering/">CT-Reverse Engineering</a>
    
      
      <a class="post-tag" href="/tags/cybersecuriy/">cybersecuriy</a>
    
      
      <a class="post-tag" href="/tags/math/">Math</a>
    
      
      <a class="post-tag" href="/tags/port-scanner/">port Scanner</a>
    
      
      <a class="post-tag" href="/tags/python/">python</a>
    
      
      <a class="post-tag" href="/tags/tamu-cryptography-engineering/">TAMU-Cryptography Engineering</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2023
          <a href="https://twitter.com/mohaemdrazzk">Mohamed F. Razzk</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://fastly.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!-- JS selector for site. -->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  

    <script src="https://fastly.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script>

  



  

    <script src="https://fastly.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script>

  



  

    <script src="https://fastly.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

  








  

  

  







  

    <script src="https://fastly.jsdelivr.net/npm/dayjs@1.11.6/dayjs.min.js"></script>

  



  

    <script src="https://fastly.jsdelivr.net/npm/dayjs@1.11.6/locale/en.min.js"></script>

  



  

    <script src="https://fastly.jsdelivr.net/npm/dayjs@1.11.6/plugin/relativeTime.min.js"></script>

  



  

    <script src="https://fastly.jsdelivr.net/npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>

  










<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
    /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
    MathJax = {
      tex: {
        /* start/end delimiter pairs for in-line math */
        inlineMath: [
          ['$', '$'],
          ['\\(', '\\)']
        ],
        /* start/end delimiter pairs for display math */
        displayMath: [
          ['$$', '$$'],
          ['\\[', '\\]']
        ]
      }
    };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://fastly.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>


<!-- commons -->

<script src="https://fastly.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

